<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Reward DJDN v7.5 - Professional Edition</title>
    
    <!-- Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Monetag SDK -->
    <script src='//libtl.com/sdk.js' data-zone='10078826' data-sdk='show_10078826'></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        :root {
            /* Colors - Enhanced Palette */
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --secondary-light: #f472b6;
            --success: #10b981;
            --success-light: #34d399;
            --warning: #f59e0b;
            --warning-light: #fbbf24;
            --danger: #ef4444;
            --info: #3b82f6;
            
            /* Backgrounds */
            --dark-bg: #0a0e1a;
            --card-bg: #1a1f35;
            --card-hover: #242b45;
            --border: #2d3558;
            --border-light: #3d4668;
            
            /* Text */
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-tertiary: #64748b;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-gold: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            --gradient-blue: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            
            /* Shadows */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            
            /* Animations */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 90px;
            position: relative;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
        }

        /* ===========================
           HEADER - ENHANCED
        =========================== */

        .header {
            background: rgba(26, 31, 53, 0.95);
            backdrop-filter: blur(20px);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .avatar {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: var(--shadow);
            flex-shrink: 0;
            position: relative;
        }

        .avatar::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 50%;
            background: var(--gradient-primary);
            opacity: 0.3;
            z-index: -1;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.1); opacity: 0.1; }
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 0;
        }

        .username {
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-level {
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .balance-display {
            background: var(--gradient-secondary);
            padding: 12px 20px;
            border-radius: 24px;
            font-weight: 800;
            font-size: 15px;
            box-shadow: var(--shadow);
            white-space: nowrap;
            transition: var(--transition);
        }

        .balance-display:active {
            transform: scale(0.95);
        }

        /* ===========================
           CONTAINER
        =========================== */

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
        }

        .page {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===========================
           CARDS - ENHANCED
        =========================== */

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: var(--transition);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-badge {
            background: var(--primary);
            color: white;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 700;
            box-shadow: var(--shadow-sm);
        }

        /* ===========================
           BUTTONS - ENHANCED
        =========================== */

        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* ===========================
           MINING SECTION - ENHANCED
        =========================== */

        .mining-container {
            text-align: center;
            padding: 40px 20px;
            position: relative;
        }

        .mining-icon {
            font-size: 100px;
            margin-bottom: 24px;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 10px 20px rgba(99, 102, 241, 0.4));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(-20px) rotate(0deg); }
            75% { transform: translateY(-10px) rotate(-5deg); }
        }

        .mining-reward {
            font-size: 48px;
            font-weight: 900;
            background: var(--gradient-blue);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(79, 172, 254, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 242, 254, 0.8)); }
        }

        .mining-timer {
            font-size: 22px;
            color: var(--text-secondary);
            margin-bottom: 28px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 28px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-blue);
            width: 0%;
            transition: width 1s ease;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.6);
        }

        /* ===========================
           GRID LAYOUTS - ENHANCED
        =========================== */

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-box {
            background: rgba(99, 102, 241, 0.15);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 2px solid rgba(99, 102, 241, 0.3);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .stat-box:hover::before {
            left: 100%;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 900;
            color: var(--primary-light);
            margin-bottom: 6px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* ===========================
           LEVEL SYSTEM - ENHANCED
        =========================== */

        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--gradient-primary);
            padding: 10px 20px;
            border-radius: 24px;
            font-weight: 700;
            font-size: 15px;
            box-shadow: var(--shadow);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }
            50% { box-shadow: 0 4px 25px rgba(118, 75, 162, 0.6); }
        }

        .xp-bar-container {
            width: 100%;
            height: 14px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin: 16px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .xp-bar-fill {
            height: 100%;
            background: var(--gradient-blue);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.6);
        }

        .xp-text {
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 10px;
            font-weight: 600;
        }

        /* ===========================
           LEADERBOARD - ENHANCED
        =========================== */

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .rank-badge {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 18px;
            box-shadow: var(--shadow);
        }

        .rank-1 { 
            background: var(--gradient-gold); 
            color: #000; 
            animation: rotate 3s linear infinite;
        }
        .rank-2 { 
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8); 
            color: #000; 
        }
        .rank-3 { 
            background: linear-gradient(135deg, #cd7f32, #e39f5f); 
            color: #000; 
        }
        .rank-other { 
            background: var(--card-hover); 
            color: var(--text-primary); 
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .leaderboard-info {
            flex: 1;
            min-width: 0;
        }

        .leaderboard-name {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .leaderboard-ads {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .leaderboard-reward {
            font-weight: 800;
            color: var(--success-light);
            font-size: 15px;
            white-space: nowrap;
        }

        /* ===========================
           TASKS - ENHANCED
        =========================== */

        .task-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
        }

        .task-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: var(--shadow);
            flex-shrink: 0;
        }

        .task-details {
            flex: 1;
            min-width: 0;
        }

        .task-title {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 6px;
        }

        .task-reward {
            font-size: 14px;
            color: var(--success-light);
            font-weight: 700;
        }

        .task-progress {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .task-progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.3s ease;
        }

        .task-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .task-btn:active {
            transform: scale(0.95);
        }

        .task-btn:disabled {
            opacity: 0.6;
        }

        /* ===========================
           WHEEL - ENHANCED
        =========================== */

        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 40px auto;
        }

        .wheel-canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.6);
        }

        .wheel-pointer {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid var(--warning);
            filter: drop-shadow(0 0 15px rgba(245, 158, 11, 0.9));
            z-index: 10;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px;
            height: 90px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 900;
            border: 5px solid var(--warning);
            box-shadow: 0 0 25px rgba(245, 158, 11, 0.7);
            z-index: 5;
        }

        /* ===========================
           REFERRAL SECTION - NEW
        =========================== */

        .referral-card {
            background: var(--gradient-success);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-xl);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .referral-card::before {
            content: '👥';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 120px;
            opacity: 0.1;
        }

        .referral-title {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 12px;
            color: white;
        }

        .referral-subtitle {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 24px;
        }

        .referral-link-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            backdrop-filter: blur(10px);
        }

        .referral-link {
            word-break: break-all;
            color: white;
            font-weight: 700;
            font-size: 13px;
            user-select: all;
        }

        .referral-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .referral-btn {
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
            color: var(--success);
        }

        .referral-btn:active {
            transform: scale(0.95);
        }

        .referral-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .referral-stat {
            background: rgba(255, 255, 255, 0.15);
            padding: 16px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .referral-stat-value {
            font-size: 24px;
            font-weight: 900;
            color: white;
            margin-bottom: 4px;
        }

        .referral-stat-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }

        /* ===========================
           WITHDRAW - ENHANCED
        =========================== */

        .withdraw-unlock {
            background: rgba(245, 158, 11, 0.15);
            border: 2px solid var(--warning);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
        }

        .unlock-progress {
            font-size: 42px;
            font-weight: 900;
            color: var(--warning);
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            font-size: 15px;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        /* ===========================
           BOTTOM NAV - ENHANCED
        =========================== */

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 31, 53, 0.98);
            backdrop-filter: blur(20px);
            border-top: 2px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 12px 0 env(safe-area-inset-bottom, 12px) 0;
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.4);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: var(--transition);
            border-radius: 16px;
            margin: 0 6px;
            position: relative;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: var(--transition);
        }

        .nav-item.active::before {
            opacity: 0.2;
        }

        .nav-icon {
            font-size: 26px;
            margin-bottom: 4px;
            position: relative;
            z-index: 1;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-secondary);
            position: relative;
            z-index: 1;
        }

        .nav-item.active .nav-label {
            color: var(--primary-light);
        }

        /* ===========================
           NOTIFICATIONS - ENHANCED
        =========================== */

        .notification {
            position: fixed;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 18px 28px;
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 90%;
            text-align: center;
            font-weight: 700;
            font-size: 15px;
        }

        .notification.show {
            opacity: 1;
        }

        .notification.error {
            background: var(--danger);
        }

        /* ===========================
           LOADING - ENHANCED
        =========================== */

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 26, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 6px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===========================
           TABS - ENHANCED
        =========================== */

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 14px 28px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 700;
            font-size: 15px;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .tab:active {
            transform: scale(0.95);
        }

        .tab.active {
            background: var(--gradient-primary);
            border-color: transparent;
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* ===========================
           COUNTDOWN - ENHANCED
        =========================== */

        .countdown {
            text-align: center;
            padding: 20px;
            background: rgba(99, 102, 241, 0.15);
            border-radius: 16px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            margin-bottom: 24px;
        }

        .countdown-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .countdown-timer {
            font-size: 28px;
            font-weight: 900;
            color: var(--primary-light);
        }

        /* ===========================
           INFO & WARNING BOXES - ENHANCED
        =========================== */

        .info-box {
            background: rgba(16, 185, 129, 0.15);
            border: 2px solid rgba(16, 185, 129, 0.4);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-box p {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .info-box strong {
            color: var(--success-light);
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.15);
            border: 2px solid rgba(245, 158, 11, 0.4);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .warning-box p {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .warning-box strong {
            color: var(--warning-light);
        }

        /* ===========================
           HISTORY - ENHANCED
        =========================== */

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .history-result {
            font-weight: 700;
            color: var(--success-light);
        }

        .history-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* ===========================
           QUICK ACTIONS - ENHANCED
        =========================== */

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .action-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 28px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: var(--transition);
        }

        .action-card:hover::before {
            opacity: 0.1;
        }

        .action-card:active {
            transform: scale(0.97);
        }

        .action-icon {
            font-size: 48px;
            margin-bottom: 14px;
            position: relative;
            z-index: 1;
        }

        .action-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
            position: relative;
            z-index: 1;
        }

        .action-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            position: relative;
            z-index: 1;
        }

        /* ===========================
           RESPONSIVE - ENHANCED
        =========================== */

        @media (max-width: 400px) {
            .container {
                padding: 16px;
            }

            .mining-icon {
                font-size: 80px;
            }

            .mining-reward {
                font-size: 38px;
            }

            .wheel-container {
                width: 280px;
                height: 280px;
            }

            .card {
                padding: 20px;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .referral-actions {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 360px) {
            .balance-display {
                font-size: 13px;
                padding: 10px 16px;
            }

            .username {
                font-size: 14px;
            }

            .nav-label {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- HEADER -->
        <div class="header">
            <div class="user-section">
                <div class="avatar">👤</div>
                <div class="user-details">
                    <div class="username" id="username">Loading...</div>
                    <div class="user-level">
                        <span id="levelBadge">🥉 Bronze</span>
                        <span id="xpText">0 XP</span>
                    </div>
                </div>
            </div>
            <div class="balance-display" id="balance">0.000000 TON</div>
        </div>

        <div class="container">
            <!-- ===========================
                 HOME PAGE
            =========================== -->
            <div class="page active" id="page-home">
                <div class="card">
                    <div class="mining-container">
                        <div class="mining-icon">⚡</div>
                        <div class="mining-reward" id="miningReward">+0.00020 TON</div>
                        <div class="mining-timer" id="miningTimer">Ready to start!</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <button class="btn btn-primary" id="mineButton" onclick="handleMiningButton()">
                            🚀 START MINING
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">📊 Quick Stats</div>
                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="stat-box">
                            <div class="stat-value" id="totalAds">0</div>
                            <div class="stat-label">Ads Today</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="totalEarnings">0.000000</div>
                            <div class="stat-label">Total Earned</div>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <div class="action-card" onclick="showPage('earn')">
                        <div class="action-icon">📺</div>
                        <div class="action-title">Watch Ads</div>
                        <div class="action-subtitle">Earn rewards</div>
                    </div>
                    <div class="action-card" onclick="showPage('tasks')">
                        <div class="action-icon">✅</div>
                        <div class="action-title">Daily Tasks</div>
                        <div class="action-subtitle">Complete & claim</div>
                    </div>
                    <div class="action-card" onclick="showPage('referral')">
                        <div class="action-icon">👥</div>
                        <div class="action-title">Invite Friends</div>
                        <div class="action-subtitle">Earn 0.00035 TON</div>
                    </div>
                    <div class="action-card" onclick="showPage('withdraw')">
                        <div class="action-icon">💰</div>
                        <div class="action-title">Withdraw</div>
                        <div class="action-subtitle">Cash out</div>
                    </div>
                </div>
            </div>

            <!-- ===========================
                 LEADERBOARD PAGE
            =========================== -->
            <div class="page" id="page-leaderboard">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">🏆 Top 50 Daily</div>
                    </div>
                    
                    <div class="countdown">
                        <div class="countdown-label">⏰ Daily Reset In</div>
                        <div class="countdown-timer" id="leaderboardTimer">--:--:--</div>
                    </div>

                    <div class="info-box">
                        <p><strong>🎁 Daily Rewards:</strong></p>
                        <p>🥇 1st Place: <strong>0.003 TON</strong></p>
                        <p>🥈 2nd Place: <strong>0.002 TON</strong></p>
                        <p>🥉 3rd Place: <strong>0.001 TON</strong></p>
                    </div>

                    <div id="leaderboardList">
                        <p style="text-align: center; color: var(--text-secondary); padding: 20px;">Loading...</p>
                    </div>

                    <div class="card" style="margin-top: 20px; background: rgba(99, 102, 241, 0.15); border-color: var(--primary);">
                        <div class="card-title">📍 Your Position</div>
                        <div id="userPosition" style="margin-top: 12px;">
                            <p style="text-align: center; color: var(--text-secondary);">Watch ads to rank!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===========================
                 REFERRAL PAGE - NEW
            =========================== -->
            <div class="page" id="page-referral">
                <div class="referral-card">
                    <div class="referral-title">👥 Invite Friends</div>
                    <div class="referral-subtitle">Earn 0.00035 TON per validated friend!</div>
                    
                    <div class="referral-link-container">
                        <div class="referral-link" id="referralLink">Loading...</div>
                    </div>
                    
                    <div class="referral-actions">
                        <button class="referral-btn" onclick="copyReferralLink()">
                            📋 Copy Link
                        </button>
                        <button class="referral-btn" onclick="shareReferralLink()">
                            📤 Share Link
                        </button>
                    </div>

                    <div class="referral-stats">
                        <div class="referral-stat">
                            <div class="referral-stat-value" id="totalInvites">0</div>
                            <div class="referral-stat-label">Total Invites</div>
                        </div>
                        <div class="referral-stat">
                            <div class="referral-stat-value" id="validatedInvites">0</div>
                            <div class="referral-stat-label">Validated</div>
                        </div>
                        <div class="referral-stat">
                            <div class="referral-stat-value" id="referralEarnings">0.000000</div>
                            <div class="referral-stat-label">Earned</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ℹ️ How It Works</div>
                    <div class="info-box" style="margin-top: 16px;">
                        <p><strong>💡 Referral System:</strong></p>
                        <p>1️⃣ Share your unique link with friends</p>
                        <p>2️⃣ They must use your link to join</p>
                        <p>3️⃣ They must open the app at least once</p>
                        <p>4️⃣ You earn <strong>0.00035 TON</strong> instantly!</p>
                        <p><strong>No limit on invitations! 🚀</strong></p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">🎁 Bonus Tips</div>
                    <div class="warning-box" style="margin-top: 16px;">
                        <p><strong>⚡ Pro Tips:</strong></p>
                        <p>• Share on social media for more reach</p>
                        <p>• Create groups with your friends</p>
                        <p>• More friends = More passive income!</p>
                        <p>• Each friend can earn too - win-win! 🤝</p>
                    </div>
                </div>
            </div>

            <!-- ===========================
                 TASKS PAGE
            =========================== -->
            <div class="page" id="page-tasks">
                <div class="tabs">
                    <div class="tab active" data-tab="daily" onclick="switchTaskTab('daily')">Daily Tasks</div>
                    <div class="tab" data-tab="onetime" onclick="switchTaskTab('onetime')">One-Time Tasks</div>
                </div>

                <!-- Daily Tasks Tab -->
                <div class="tab-content active" id="tab-daily">
                    <div class="countdown">
                        <div class="countdown-label">⏰ Tasks Reset In</div>
                        <div class="countdown-timer" id="tasksTimer">--:--:--</div>
                    </div>

                    <div class="warning-box">
                        <p><strong>⚠️ Important:</strong></p>
                        <p>Claim rewards before UTC midnight or they will expire!</p>
                    </div>

                    <div id="dailyTasksList">
                        <!-- Task 1 -->
                        <div class="task-item">
                            <div class="task-icon">🎯</div>
                            <div class="task-details">
                                <div class="task-title">Daily Challenge #1</div>
                                <div class="task-reward">+0.001 TON</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">
                                    2× mining, 300 ads, ≥40 coins
                                </div>
                                <div class="task-progress">
                                    <div class="task-progress-fill" id="task1Progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <button class="task-btn" id="task1Btn" onclick="claimDailyTask(1)">Check</button>
                        </div>

                        <!-- Task 2 -->
                        <div class="task-item">
                            <div class="task-icon">🎯</div>
                            <div class="task-details">
                                <div class="task-title">Daily Challenge #2</div>
                                <div class="task-reward">+0.002 TON</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">
                                    4× mining, 500 ads, ≥70 coins
                                </div>
                                <div class="task-progress">
                                    <div class="task-progress-fill" id="task2Progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <button class="task-btn" id="task2Btn" onclick="claimDailyTask(2)">Check</button>
                        </div>

                        <!-- Task 3 -->
                        <div class="task-item">
                            <div class="task-icon">🎯</div>
                            <div class="task-details">
                                <div class="task-title">Daily Challenge #3</div>
                                <div class="task-reward">+0.003 TON</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">
                                    5× mining, 700 ads, ≥100 coins
                                </div>
                                <div class="task-progress">
                                    <div class="task-progress-fill" id="task3Progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <button class="task-btn" id="task3Btn" onclick="claimDailyTask(3)">Check</button>
                        </div>
                    </div>
                </div>

                <!-- One-Time Tasks Tab -->
                <div class="tab-content" id="tab-onetime">
                    <div class="info-box">
                        <p><strong>✅ Complete these tasks once to unlock features!</strong></p>
                        <p>Required before first withdrawal.</p>
                    </div>

                    <div id="onetimeTasksList">
                        <!-- Join Channel Task -->
                        <div class="task-item">
                            <div class="task-icon">📢</div>
                            <div class="task-details">
                                <div class="task-title">Join Official Channel</div>
                                <div class="task-reward">+0.0001 TON</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">
                                    Required for withdrawal
                                </div>
                            </div>
                            <button class="task-btn" id="channelTaskBtn" onclick="handleChannelTask()">Join</button>
                        </div>

                        <!-- Join Withdraw Channel Task -->
                        <div class="task-item">
                            <div class="task-icon">💸</div>
                            <div class="task-details">
                                <div class="task-title">Join Withdraw Proofs</div>
                                <div class="task-reward">+0.0001 TON</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">
                                    Required for withdrawal
                                </div>
                            </div>
                            <button class="task-btn" id="withdrawChannelTaskBtn" onclick="handleWithdrawChannelTask()">Join</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===========================
                 EARN PAGE
            =========================== -->
            <div class="page" id="page-earn">
                <div class="tabs">
                    <div class="tab active" data-tab="simple" onclick="switchEarnTab('simple')">Watch Ads</div>
                    <div class="tab" data-tab="wheel" onclick="switchEarnTab('wheel')">Lucky Wheel</div>
                </div>

                <!-- Watch Simple Tab -->
                <div class="tab-content active" id="earn-simple">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">📺 Watch Ads</div>
                            <div class="card-badge" id="simpleAdsCount">0/1000</div>
                        </div>

                        <div class="mining-container">
                            <div class="mining-icon">📺</div>
                            <div class="mining-reward">+0.000012 TON</div>
                            <div class="mining-timer" style="font-size: 16px; color: var(--text-secondary);">
                                Per ad watched
                            </div>
                        </div>

                        <div class="info-box">
                            <p><strong>💡 How it works:</strong></p>
                            <p>• Earn <strong>0.000012 TON</strong> per ad</p>
                            <p>• Watch up to <strong>1000 ads/day</strong></p>
                            <p>• After 200 ads: <strong>10-minute cooldown</strong></p>
                            <p>• Ads alternate: Popup ↔ Interstitial</p>
                        </div>

                        <button class="btn btn-secondary" id="watchSimpleBtn" onclick="watchSimpleAd()">
                            ▶️ WATCH AD NOW
                        </button>

                        <div id="simpleCooldown" style="text-align: center; margin-top: 12px; color: var(--text-secondary); font-size: 14px;"></div>

                        <div class="grid-2" style="margin-top: 20px;">
                            <div class="stat-box">
                                <div class="stat-value" id="simpleToday">0</div>
                                <div class="stat-label">Today</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="simpleTotal">0</div>
                                <div class="stat-label">Total</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lucky Wheel Tab -->
                <div class="tab-content" id="earn-wheel">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🔑 Earn Keys</div>
                            <div class="card-badge" id="keysCount">0 Keys</div>
                        </div>

                        <div class="info-box">
                            <p><strong>🎁 How to get Keys:</strong></p>
                            <p>• Watch rewarded ads to earn Keys</p>
                            <p>• <strong>1 ad = 1 Key + 1 Coin</strong></p>
                            <p>• Max <strong>250 keys/day</strong></p>
                            <p>• After 50 keys: <strong>10-minute cooldown</strong></p>
                            <p>• Keys reset at UTC midnight!</p>
                        </div>

                        <button class="btn btn-primary" id="watchKeyBtn" onclick="watchForKey()">
                            ▶️ WATCH AD (+1 KEY)
                        </button>

                        <div id="keyCooldown" style="text-align: center; margin-top: 12px; color: var(--text-secondary); font-size: 14px;"></div>

                        <div class="grid-2" style="margin-top: 20px;">
                            <div class="stat-box">
                                <div class="stat-value" id="keysToday">0</div>
                                <div class="stat-label">Keys Today</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="keysAdsTotal">0</div>
                                <div class="stat-label">Total Ads</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">🎰 Lucky Wheel</div>
                        
                        <div class="wheel-container">
                            <div class="wheel-pointer"></div>
                            <canvas id="wheelCanvas" class="wheel-canvas" width="320" height="320"></canvas>
                            <div class="wheel-center">SPIN</div>
                        </div>

                        <button class="btn btn-secondary" id="spinBtn" onclick="spinWheel()">
                            🎲 SPIN (1 KEY)
                        </button>

                        <div style="text-align: center; margin-top: 12px; color: var(--text-secondary); font-size: 14px;">
                            You have <strong id="spinKeysDisplay">0</strong> keys
                        </div>

                        <div class="card" style="margin-top: 20px; background: rgba(255, 255, 255, 0.03);">
                            <div class="card-title" style="font-size: 17px;">🏆 Last 5 Spins</div>
                            <div id="spinHistory" style="margin-top: 12px;">
                                <p style="text-align: center; color: var(--text-secondary); padding: 20px;">No spins yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===========================
                 LEVEL PAGE
            =========================== -->
            <div class="page" id="page-level">
                <div class="tabs">
                    <div class="tab active" data-tab="stats" onclick="switchLevelTab('stats')">My Level</div>
                    <div class="tab" data-tab="guide" onclick="switchLevelTab('guide')">Guide</div>
                </div>

                <!-- My Level Tab -->
                <div class="tab-content active" id="level-stats">
                    <div class="card">
                        <div style="text-align: center;">
                            <div class="level-badge" id="currentLevelBadge">🥉 Bronze</div>
                            <div class="xp-bar-container">
                                <div class="xp-bar-fill" id="xpBar" style="width: 0%"></div>
                            </div>
                            <div class="xp-text" id="xpProgress">0 / 2000 XP</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">📊 Level Benefits</div>
                        <div style="margin-top: 16px;">
                            <div style="display: flex; justify-content: space-between; padding: 14px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; margin-bottom: 10px;">
                                <span>Auto Mining Bonus:</span>
                                <strong id="miningBonus">0.00020 TON</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 14px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; margin-bottom: 10px;">
                                <span>Min Withdraw:</span>
                                <strong id="minWithdraw">0.003 TON</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 14px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                                <span>Daily Ads Needed:</span>
                                <strong id="adsNeeded">300 ads</strong>
                            </div>
                        </div>
                    </div>

                    <div class="warning-box">
                        <p><strong>⚠️ Level Protection:</strong></p>
                        <p>• Watch <strong>300+ ads/day</strong> to keep your level</p>
                        <p>• <strong>&lt;300 ads</strong> = lose one level</p>
                        <p>• <strong>1 day inactive</strong> = reset to Bronze</p>
                        <p id="adsWarning"></p>
                    </div>

                    <div class="card">
                        <div class="card-title">🎯 All Levels</div>
                        <div style="margin-top: 16px;">
                            <div style="padding: 14px; background: rgba(205, 127, 50, 0.15); border: 2px solid rgba(205, 127, 50, 0.4); border-radius: 12px; margin-bottom: 10px;">
                                <div style="font-weight: 700; font-size: 15px;">🥉 Bronze (0-1999 XP)</div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 6px;">
                                    Mining: 0.00020 TON | Min Withdraw: 0.003 TON
                                </div>
                            </div>
                            <div style="padding: 14px; background: rgba(192, 192, 192, 0.15); border: 2px solid rgba(192, 192, 192, 0.4); border-radius: 12px; margin-bottom: 10px;">
                                <div style="font-weight: 700; font-size: 15px;">🥈 Silver (2000-3999 XP)</div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 6px;">
                                    Mining: 0.00035 TON | Min Withdraw: 0.001 TON
                                </div>
                            </div>
                            <div style="padding: 14px; background: rgba(255, 215, 0, 0.15); border: 2px solid rgba(255, 215, 0, 0.4); border-radius: 12px; margin-bottom: 10px;">
                                <div style="font-weight: 700; font-size: 15px;">🥇 Gold (4000-5999 XP)</div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 6px;">
                                    Mining: 0.00050 TON | Min Withdraw: 0.0009 TON
                                </div>
                            </div>
                            <div style="padding: 14px; background: rgba(229, 228, 226, 0.15); border: 2px solid rgba(229, 228, 226, 0.4); border-radius: 12px; margin-bottom: 10px;">
                                <div style="font-weight: 700; font-size: 15px;">💎 Platinum (6000-7999 XP)</div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 6px;">
                                    Mining: 0.00065 TON | Min Withdraw: 0.0008 TON
                                </div>
                            </div>
                            <div style="padding: 14px; background: rgba(185, 242, 255, 0.15); border: 2px solid rgba(185, 242, 255, 0.4); border-radius: 12px;">
                                <div style="font-weight: 700; font-size: 15px;">💎 Diamond (8000+ XP)</div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 6px;">
                                    Mining: 0.00080 TON | Min Withdraw: 0.0007 TON
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Guide Tab -->
                <div class="tab-content" id="level-guide">
                    <div class="card">
                        <div class="card-title">📖 Complete Guide</div>
                        
                        <div style="margin-top: 20px;">
                            <h3 style="font-size: 17px; margin-bottom: 14px; color: var(--primary-light); font-weight: 800;">🎯 What is the Level System?</h3>
                            <p style="font-size: 14px; line-height: 1.7; color: var(--text-secondary); margin-bottom: 20px;">
                                The Level System rewards active users with better benefits. As you watch ads and complete tasks, you earn XP (Experience Points) to level up. Higher levels give you bigger mining rewards and lower withdrawal limits!
                            </p>

                            <h3 style="font-size: 17px; margin-bottom: 14px; color: var(--primary-light); font-weight: 800;">⬆️ How to Level Up</h3>
                            <p style="font-size: 14px; line-height: 1.7; color: var(--text-secondary); margin-bottom: 10px;">
                                • Watch 1 ad = <strong style="color: var(--success-light);">+2 XP</strong><br>
                                • Each level requires <strong style="color: var(--success-light);">2000 XP</strong><br>
                                • Bronze → Silver: 2000 XP<br>
                                • Silver → Gold: 4000 XP total<br>
                                • Gold → Platinum: 6000 XP total<br>
                                • Platinum → Diamond: 8000 XP total
                            </p>

                            <h3 style="font-size: 17px; margin-bottom: 14px; margin-top: 24px; color: var(--warning-light); font-weight: 800;">⚠️ Level Protection Rules</h3>
                            <p style="font-size: 14px; line-height: 1.7; color: var(--text-secondary); margin-bottom: 10px;">
                                To keep your level, you must stay active:<br>
                                • Watch <strong style="color: var(--warning-light);">300+ ads per day</strong><br>
                                • If you watch <strong>&lt;300 ads</strong>, you lose one level<br>
                                • If you're <strong>inactive for 1 day</strong>, you reset to Bronze<br>
                                • Resets happen at UTC midnight
                            </p>

                            <h3 style="font-size: 17px; margin-bottom: 14px; margin-top: 24px; color: var(--success-light); font-weight: 800;">💰 Level Benefits</h3>
                            <p style="font-size: 14px; line-height: 1.7; color: var(--text-secondary); margin-bottom: 10px;">
                                <strong>Auto Mining Bonus (every 3 hours):</strong><br>
                                🥉 Bronze: 0.00020 TON<br>
                                🥈 Silver: 0.00035 TON<br>
                                🥇 Gold: 0.00050 TON<br>
                                💎 Platinum: 0.00065 TON<br>
                                💎 Diamond: 0.00080 TON
                            </p>
                            <p style="font-size: 14px; line-height: 1.7; color: var(--text-secondary); margin-top: 14px;">
                                <strong>Minimum Withdrawal:</strong><br>
                                🥉 Bronze: 0.003 TON<br>
                                🥈 Silver: 0.001 TON<br>
                                🥇 Gold: 0.0009 TON<br>
                                💎 Platinum: 0.0008 TON<br>
                                💎 Diamond: 0.0007 TON
                            </p>

                            <h3 style="font-size: 17px; margin-bottom: 14px; margin-top: 24px; color: var(--primary-light); font-weight: 800;">💡 Pro Tips</h3>
                            <p style="font-size: 14px; line-height: 1.7; color: var(--text-secondary);">
                                • Watch ads consistently every day<br>
                                • Aim for 300+ ads daily to protect your level<br>
                                • Higher levels = better rewards!<br>
                                • Complete daily tasks for bonus XP<br>
                                • Use the Lucky Wheel to earn extra TON
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===========================
                 WITHDRAW PAGE
            =========================== -->
            <div class="page" id="page-withdraw">
                <div class="card">
                    <div class="card-title">💰 Withdraw to FaucetPay</div>

                    <div class="info-box" style="margin-top: 16px;">
                        <p><strong>✅ Before you withdraw:</strong></p>
                        <p>• Join both official channels (required)</p>
                        <p>• Watch 5 withdraw ads (resets after 2 withdrawals)</p>
                        <p>• Minimum based on your level</p>
                        <p>• <strong>NO GAS FEES!</strong> 🎉</p>
                    </div>

                    <!-- Channel Check Warning -->
                    <div class="warning-box" id="channelWarning" style="display: none;">
                        <p><strong>⚠️ Channels Required!</strong></p>
                        <p>You must join both official channels before making a withdrawal.</p>
                        <p id="channelStatus"></p>
                        <button class="btn btn-primary" style="margin-top: 12px;" onclick="showPage('tasks')">
                            Go to Tasks
                        </button>
                    </div>

                    <!-- Withdraw Ads Unlock -->
                    <div class="withdraw-unlock" id="withdrawUnlock">
                        <div style="font-size: 19px; font-weight: 800; margin-bottom: 14px;">
                            🔓 Unlock Withdrawal
                        </div>
                        <div class="unlock-progress" id="unlockProgress">0/5</div>
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 18px;">
                            Watch 5 ads to unlock withdrawal<br>
                            (Resets after 2 withdrawals)
                        </p>
                        <button class="btn btn-warning" id="unlockBtn" onclick="watchWithdrawAd()" style="background: var(--warning);">
                            📺 WATCH AD TO UNLOCK
                        </button>
                    </div>

                    <!-- Withdraw Form -->
                    <div id="withdrawForm">
                        <div class="form-group">
                            <label class="form-label">FaucetPay Email</label>
                            <input type="email" class="form-input" id="faucetpayEmail" placeholder="your@email.com">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Amount (min <span id="minWithdrawAmount">0.003</span> TON)</label>
                            <input type="number" class="form-input" id="withdrawAmount" placeholder="0.003" min="0.0007" step="0.000001">
                        </div>

                        <button class="btn btn-success" id="withdrawBtn" onclick="handleWithdraw()" disabled>
                            🔒 COMPLETE REQUIREMENTS FIRST
                        </button>
                    </div>

                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="stat-box">
                            <div class="stat-value" id="totalWithdrawn">0.000000</div>
                            <div class="stat-label">Total Withdrawn</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="withdrawCount">0</div>
                            <div class="stat-label">Withdrawals</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOTTOM NAVIGATION -->
        <div class="bottom-nav">
            <div class="nav-item active" data-page="home" onclick="showPage('home')">
                <div class="nav-icon">🏠</div>
                <div class="nav-label">Home</div>
            </div>
            <div class="nav-item" data-page="leaderboard" onclick="showPage('leaderboard')">
                <div class="nav-icon">🏆</div>
                <div class="nav-label">Top 50</div>
            </div>
            <div class="nav-item" data-page="tasks" onclick="showPage('tasks')">
                <div class="nav-icon">✅</div>
                <div class="nav-label">Tasks</div>
            </div>
            <div class="nav-item" data-page="earn" onclick="showPage('earn')">
                <div class="nav-icon">📺</div>
                <div class="nav-label">Earn</div>
            </div>
            <div class="nav-item" data-page="referral" onclick="showPage('referral')">
                <div class="nav-icon">👥</div>
                <div class="nav-label">Invite</div>
            </div>
            <div class="nav-item" data-page="withdraw" onclick="showPage('withdraw')">
                <div class="nav-icon">💰</div>
                <div class="nav-label">Withdraw</div>
            </div>
        </div>

        <!-- NOTIFICATION -->
        <div class="notification" id="notification"></div>

        <!-- LOADING -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loader"></div>
        </div>
    </div>

    <!-- ===========================
         JAVASCRIPT
    =========================== -->
    <script>
        // ===========================
        // CONFIGURATION
        // ===========================
        
        const CONFIG = {
            API_URL: 'https://ton-reward-djdn-backend.onrender.com',
            BOT_USERNAME: 'TONRewardCrewBot',
            CHANNEL_USERNAME: 'TONRewardCrew',
            WITHDRAW_CHANNEL_USERNAME: 'djdn_withdraw_payments',
            SUPPORT_USERNAME: 'djdn_crew_support',
            
            LEVELS: {
                BRONZE: { name: 'Bronze', emoji: '🥉', min_xp: 0, max_xp: 1999, mining_bonus: 0.00020, min_withdraw: 0.003 },
                SILVER: { name: 'Silver', emoji: '🥈', min_xp: 2000, max_xp: 3999, mining_bonus: 0.00035, min_withdraw: 0.001 },
                GOLD: { name: 'Gold', emoji: '🥇', min_xp: 4000, max_xp: 5999, mining_bonus: 0.00050, min_withdraw: 0.0009 },
                PLATINUM: { name: 'Platinum', emoji: '💎', min_xp: 6000, max_xp: 7999, mining_bonus: 0.00065, min_withdraw: 0.0008 },
                DIAMOND: { name: 'Diamond', emoji: '💎', min_xp: 8000, max_xp: 999999, mining_bonus: 0.00080, min_withdraw: 0.0007 }
            }
        };

        // Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Global Variables
        let userData = null;
        let telegramId = null;
        let username = null;
        let firstName = null;
        let miningInterval = null;
        let monetagLoaded = false;
        let adCounter = 0;
        let wheelSpinning = false;

        // Check Monetag SDK
        function checkMonetagSDK() {
            if (typeof show_10078826 !== 'undefined') {
                monetagLoaded = true;
                return true;
            }
            return false;
        }

        window.addEventListener('load', () => {
            setTimeout(() => {
                checkMonetagSDK();
            }, 1000);
        });

        // ===========================
        // USER MANAGEMENT
        // ===========================

        function getTelegramUser() {
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                telegramId = tg.initDataUnsafe.user.id;
                username = tg.initDataUnsafe.user.username || tg.initDataUnsafe.user.first_name || 'User';
                firstName = tg.initDataUnsafe.user.first_name || username;
                const startParam = tg.initDataUnsafe.start_param;
                return { telegramId, username, firstName, referrerId: startParam };
            }
            telegramId = 'test_' + Date.now();
            username = 'Test User';
            firstName = 'Test';
            return { telegramId, username, firstName, referrerId: null };
        }

        async function loadUserData() {
            try {
                showLoading(true);
                const { telegramId, username, firstName, referrerId } = getTelegramUser();
                
                const response = await fetch(`${CONFIG.API_URL}/user/${telegramId}?referrer=${referrerId || ''}`);
                
                if (response.status === 404) {
                    await createUser(telegramId, username, firstName, referrerId);
                    return;
                }
                
                userData = await response.json();
                updateUI();
                startMiningCheck();
                startTimers();
                initWheel();
                showLoading(false);
            } catch (error) {
                console.error('Load error:', error);
                showNotification('Connection error: ' + error.message, 'error');
                showLoading(false);
            }
        }

        async function createUser(tid, uname, fname, refId) {
            try {
                const response = await fetch(`${CONFIG.API_URL}/user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        telegram_id: tid,
                        username: uname,
                        first_name: fname,
                        referrer_id: refId
                    })
                });
                userData = await response.json();
                updateUI();
                startMiningCheck();
                startTimers();
                initWheel();
                showLoading(false);
            } catch (error) {
                console.error('Create error:', error);
                showNotification('Account creation error', 'error');
                showLoading(false);
            }
        }

        function getUserLevel(xp) {
            xp = xp || 0;
            for (let level in CONFIG.LEVELS) {
                const lvl = CONFIG.LEVELS[level];
                if (xp >= lvl.min_xp && xp <= lvl.max_xp) {
                    return lvl;
                }
            }
            return CONFIG.LEVELS.BRONZE;
        }

        function updateUI() {
            if (!userData) return;
            
            const xp = userData.xp || 0;
            const level = getUserLevel(xp);
            
            // Header
            document.getElementById('username').textContent = userData.first_name || userData.username;
            document.getElementById('balance').textContent = (userData.balance || 0).toFixed(6) + ' TON';
            document.getElementById('levelBadge').textContent = `${level.emoji} ${level.name}`;
            document.getElementById('xpText').textContent = `${xp} XP`;
            
            // Home Stats
            const totalAdsToday = (userData.ads_watch_simple_today || 0) + (userData.ads_for_keys_today || 0) + 
                                  (userData.mining_count || 0) + (userData.withdraw_ads_watched_current || 0);
            document.getElementById('totalAds').textContent = totalAdsToday;
            document.getElementById('totalEarnings').textContent = (userData.earnings_total || 0).toFixed(6);
            
            // Mining Reward
            document.getElementById('miningReward').textContent = `+${level.mining_bonus.toFixed(5)} TON`;
            
            // Earn Page - Simple
            document.getElementById('simpleAdsCount').textContent = `${userData.ads_watch_simple_today || 0}/1000`;
            document.getElementById('simpleToday').textContent = userData.ads_watch_simple_today || 0;
            document.getElementById('simpleTotal').textContent = userData.ads_watch_simple_total || 0;
            
            // Earn Page - Wheel
            const keysCount = userData.keys_current || 0;
            document.getElementById('keysCount').textContent = `${keysCount} Keys`;
            document.getElementById('keysToday').textContent = userData.keys_earned_today || 0;
            document.getElementById('keysAdsTotal').textContent = userData.ads_for_keys_total || 0;
            document.getElementById('spinKeysDisplay').textContent = keysCount;
            
            // Referral Page - NEW
            const referralLink = userData.invitation_link || `https://t.me/${CONFIG.BOT_USERNAME}?start=${userData.telegram_id}`;
            document.getElementById('referralLink').textContent = referralLink;
            document.getElementById('totalInvites').textContent = userData.invitations_count || 0;
            document.getElementById('validatedInvites').textContent = userData.invitations_count || 0;
            document.getElementById('referralEarnings').textContent = ((userData.invitations_count || 0) * 0.00035).toFixed(6);
            
            // Level Page
            document.getElementById('currentLevelBadge').textContent = `${level.emoji} ${level.name}`;
            const xpInLevel = xp - level.min_xp;
            const xpNeeded = level.max_xp - level.min_xp + 1;
            const xpPercent = (xpInLevel / xpNeeded) * 100;
            document.getElementById('xpBar').style.width = xpPercent + '%';
            document.getElementById('xpProgress').textContent = `${xp} / ${level.max_xp + 1} XP`;
            document.getElementById('miningBonus').textContent = level.mining_bonus.toFixed(5) + ' TON';
            document.getElementById('minWithdraw').textContent = level.min_withdraw.toFixed(4) + ' TON';
            document.getElementById('adsNeeded').textContent = '300 ads';
            
            // Ads Warning
            const adsRemaining = Math.max(0, 300 - totalAdsToday);
            const warningEl = document.getElementById('adsWarning');
            if (warningEl) {
                if (adsRemaining > 0) {
                    warningEl.innerHTML = `<strong>⚠️ Watch ${adsRemaining} more ads today to keep your level!</strong>`;
                } else {
                    warningEl.innerHTML = `<strong style="color: var(--success-light);">✅ You're safe! Level protected for today.</strong>`;
                }
            }
            
            // Withdraw Page
            document.getElementById('minWithdrawAmount').textContent = level.min_withdraw.toFixed(4);
            document.getElementById('totalWithdrawn').textContent = (userData.total_withdrawn || 0).toFixed(6);
            document.getElementById('withdrawCount').textContent = userData.withdraw_history?.length || 0;
            
            const adsWatched = userData.withdraw_ads_watched_current || 0;
            document.getElementById('unlockProgress').textContent = `${adsWatched}/5`;
            
            // Check channel requirements
            checkWithdrawRequirements();
            
            // Update spin history
            updateSpinHistory();
        }

        function updateSpinHistory() {
            if (!userData) return;
            
            const historyList = document.getElementById('spinHistory');
            const history = userData.lucky_wheel_history || [];
            
            if (history.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">No spins yet</p>';
                return;
            }
            
            historyList.innerHTML = history.slice(0, 5).map(item => {
                const resultText = item.result === 'RETRY' ? 
                    '🔄 RETRY (Free Spin)' : 
                    `${Number(item.result).toFixed(6)} TON`;
                const timeAgo = formatTimeAgo(new Date(item.date));
                
                return `
                    <div class="history-item">
                        <div class="history-result">${resultText}</div>
                        <div class="history-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        function formatTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        async function checkWithdrawRequirements() {
            if (!userData) return;
            
            const channelDone = userData.tasks_done?.includes('join_channel') || false;
            const withdrawChannelDone = userData.tasks_done?.includes('join_withdraw_channel') || false;
            const adsWatched = userData.withdraw_ads_watched_current || 0;
            
            const channelWarning = document.getElementById('channelWarning');
            const withdrawUnlock = document.getElementById('withdrawUnlock');
            const withdrawBtn = document.getElementById('withdrawBtn');
            
            if (!channelDone || !withdrawChannelDone) {
                channelWarning.style.display = 'block';
                let status = '• ';
                if (!channelDone) status += '❌ Join Official Channel<br>• ';
                if (!withdrawChannelDone) status += '❌ Join Withdraw Proofs';
                document.getElementById('channelStatus').innerHTML = status;
                withdrawBtn.disabled = true;
                withdrawBtn.textContent = '🔒 JOIN CHANNELS FIRST';
                return;
            } else {
                channelWarning.style.display = 'none';
            }
            
            if (adsWatched >= 5) {
                withdrawUnlock.style.background = 'rgba(16, 185, 129, 0.15)';
                withdrawUnlock.style.borderColor = 'var(--success)';
                document.getElementById('unlockBtn').textContent = '✅ UNLOCKED!';
                document.getElementById('unlockBtn').disabled = true;
                withdrawBtn.disabled = false;
                withdrawBtn.textContent = '💸 WITHDRAW NOW';
            } else {
                withdrawUnlock.style.background = 'rgba(245, 158, 11, 0.15)';
                withdrawUnlock.style.borderColor = 'var(--warning)';
                document.getElementById('unlockBtn').textContent = `📺 WATCH AD (${adsWatched}/5)`;
                document.getElementById('unlockBtn').disabled = false;
                withdrawBtn.disabled = true;
                withdrawBtn.textContent = `🔒 WATCH ${5 - adsWatched} MORE ADS`;
            }
        }

        // ===========================
        // REFERRAL FUNCTIONS - NEW
        // ===========================

        function copyReferralLink() {
            const link = document.getElementById('referralLink').textContent;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(link).then(() => {
                    showNotification('📋 Link copied to clipboard!');
                }).catch(() => {
                    fallbackCopy(link);
                });
            } else {
                fallbackCopy(link);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('📋 Link copied!');
            } catch (err) {
                showNotification('❌ Copy failed', 'error');
            }
            document.body.removeChild(textArea);
        }

        function shareReferralLink() {
            const link = document.getElementById('referralLink').textContent;
            const text = `🎉 Join TON Reward DJDN v7.5! 💰\n\nEarn TON cryptocurrency by watching ads!\n\n✅ Level System\n✅ Daily Tasks\n✅ Lucky Wheel\n✅ Instant Withdrawals\n\nJoin now:`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'TON Reward DJDN',
                    text: text,
                    url: link
                }).catch((err) => {
                    if (err.name !== 'AbortError') {
                        openTelegramShare(link);
                    }
                });
            } else {
                openTelegramShare(link);
            }
        }

        function openTelegramShare(link) {
            const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent('🎉 Join TON Reward DJDN! Earn TON by watching ads! 💰')}`;
            window.open(shareUrl, '_blank');
        }

        // ===========================
        // MINING
        // ===========================

        function handleMiningButton() {
            if (!userData) return;

            const now = Date.now();
            
            if (userData.mining_start_time) {
                const start = new Date(userData.mining_start_time).getTime();
                const elapsed = now - start;
                const duration = 3 * 60 * 60 * 1000;
                
                if (elapsed >= duration) {
                    watchMiningAdThenClaim();
                } else {
                    showNotification('⏰ Mining in progress...', 'error');
                }
            } else {
                watchMiningAdThenStart();
            }
        }

        async function watchMiningAdThenStart() {
            if (!checkMonetagSDK()) {
                showNotification('⚠️ Ad system loading, please wait...', 'error');
                return;
            }

            try {
                showLoading(true);
                
                const adType = adCounter % 2 === 0 ? 'pop' : 'interstitial';
                adCounter++;
                
                const adPromise = adType === 'pop' ? show_10078826('pop') : show_10078826();
                
                adPromise.then(async () => {
                    try {
                        const response = await fetch(`${CONFIG.API_URL}/mining/${userData.telegram_id}/start`, {
                            method: 'POST'
                        });
                        const data = await response.json();
                        
                        if (response.ok) {
                            userData = data;
                            updateUI();
                            startMiningCheck();
                            showNotification('⛏️ Mining started!');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Mining error: ' + error.message, 'error');
                    }
                    
                    showLoading(false);
                }).catch((error) => {
                    showNotification('Please watch the ad completely', 'error');
                    showLoading(false);
                });

            } catch (error) {
                showNotification('Ad error: ' + error.message, 'error');
                showLoading(false);
            }
        }

        async function watchMiningAdThenClaim() {
            if (!checkMonetagSDK()) {
                showNotification('⚠️ Ad system loading, please wait...', 'error');
                return;
            }

            try {
                showLoading(true);
                
                const adType = adCounter % 2 === 0 ? 'pop' : 'interstitial';
                adCounter++;
                
                const adPromise = adType === 'pop' ? show_10078826('pop') : show_10078826();
                
                adPromise.then(async () => {
                    try {
                        const response = await fetch(`${CONFIG.API_URL}/mining/${userData.telegram_id}/claim`, {
                            method: 'POST'
                        });
                        const data = await response.json();
                        
                        if (response.ok) {
                            userData = data;
                            updateUI();
                            showNotification('🎉 Mining reward claimed!');
                            clearInterval(miningInterval);
                            startMiningCheck();
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Claim error: ' + error.message, 'error');
                    }
                    
                    showLoading(false);
                }).catch((error) => {
                    showNotification('Please watch the ad completely', 'error');
                    showLoading(false);
                });

            } catch (error) {
                showNotification('Ad error: ' + error.message, 'error');
                showLoading(false);
            }
        }

        function startMiningCheck() {
            if (miningInterval) clearInterval(miningInterval);
            
            miningInterval = setInterval(() => {
                if (!userData || !userData.mining_start_time) {
                    document.getElementById('mineButton').disabled = false;
                    document.getElementById('mineButton').textContent = '🚀 START MINING';
                    document.getElementById('miningTimer').textContent = 'Ready to start!';
                    document.getElementById('progressFill').style.width = '0%';
                    return;
                }

                const now = Date.now();
                const start = new Date(userData.mining_start_time).getTime();
                const duration = 3 * 60 * 60 * 1000;
                const elapsed = now - start;
                const remaining = duration - elapsed;

                if (remaining <= 0) {
                    document.getElementById('mineButton').disabled = false;
                    document.getElementById('mineButton').textContent = '💰 CLAIM REWARD';
                    document.getElementById('miningTimer').textContent = '✅ Ready to claim!';
                    document.getElementById('progressFill').style.width = '100%';
                } else {
                    const hours = Math.floor(remaining / 3600000);
                    const minutes = Math.floor((remaining % 3600000) / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    
                    document.getElementById('miningTimer').textContent = 
                        `⏰ ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    const progress = (elapsed / duration) * 100;
                    document.getElementById('progressFill').style.width = progress + '%';
                    document.getElementById('mineButton').disabled = true;
                    document.getElementById('mineButton').textContent = '⏳ MINING...';
                }
            }, 1000);
        }

        // ===========================
        // WATCH SIMPLE ADS
        // ===========================

        async function watchSimpleAd() {
            if (!userData) return;
            
            const watchedToday = userData.ads_watch_simple_today || 0;
            if (watchedToday >= 1000) {
                showNotification('⚠️ Daily limit reached (1000 ads)', 'error');
                return;
            }

            if (!checkMonetagSDK()) {
                showNotification('⚠️ Ad system loading, please wait...', 'error');
                return;
            }

            try {
                showLoading(true);
                
                const adType = adCounter % 2 === 0 ? 'pop' : 'interstitial';
                adCounter++;
                
                const adPromise = adType === 'pop' ? show_10078826('pop') : show_10078826();

                adPromise.then(async () => {
                    try {
                        const response = await fetch(`${CONFIG.API_URL}/earn/watch-simple/${userData.telegram_id}`, {
                            method: 'POST'
                        });
                        const data = await response.json();
                        
                        if (response.ok) {
                            userData = data;
                            updateUI();
                            showNotification('🎉 +0.000012 TON earned!');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Error: ' + error.message, 'error');
                    }
                    
                    showLoading(false);
                }).catch((error) => {
                    showNotification('Ad closed or error occurred', 'error');
                    showLoading(false);
                });

            } catch (error) {
                showNotification('Ad error: ' + error.message, 'error');
                showLoading(false);
            }
        }

        // ===========================
        // WATCH FOR KEYS
        // ===========================

        async function watchForKey() {
            if (!userData) return;
            
            const adsToday = userData.ads_for_keys_today || 0;
            if (adsToday >= 250) {
                showNotification('⚠️ Daily limit reached (250 ads)', 'error');
                return;
            }

            if (!checkMonetagSDK()) {
                showNotification('⚠️ Ad system loading, please wait...', 'error');
                return;
            }

            try {
                showLoading(true);

                const adType = adCounter % 2 === 0 ? 'pop' : 'interstitial';
                adCounter++;
                
                const adPromise = adType === 'pop' ? show_10078826('pop') : show_10078826();

                adPromise.then(async () => {
                    try {
                        const response = await fetch(`${CONFIG.API_URL}/earn/watch-for-key/${userData.telegram_id}`, {
                            method: 'POST'
                        });
                        const data = await response.json();
                        
                        if (response.ok) {
                            userData = data;
                            updateUI();
                            showNotification('🔑 +1 Key earned! (+1 Coin)');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Error: ' + error.message, 'error');
                    }
                    
                    showLoading(false);
                }).catch((error) => {
                    showNotification('Please watch the ad completely', 'error');
                    showLoading(false);
                });

            } catch (error) {
                showNotification('Ad error: ' + error.message, 'error');
                showLoading(false);
            }
        }

        // ===========================
        // LUCKY WHEEL
        // ===========================

        function initWheel() {
            const canvas = document.getElementById('wheelCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 150;

            const segments = [
                { label: '0.000009', color: '#3b82f6', icon: '💧' },
                { label: '0.000012', color: '#eab308', icon: '💛' },
                { label: '0.000010', color: '#06b6d4', icon: '💙' },
                { label: '0.000015', color: '#10b981', icon: '💚' },
                { label: '0.000017', color: '#8b5cf6', icon: '💎' },
                { label: 'RETRY', color: '#f59e0b', icon: '🔄' }
            ];

            function drawWheel(rotation = 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const anglePerSegment = (2 * Math.PI) / segments.length;
                
                segments.forEach((segment, i) => {
                    const startAngle = rotation + i * anglePerSegment;
                    const endAngle = startAngle + anglePerSegment;
                    
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                    ctx.closePath();
                    ctx.fillStyle = segment.color;
                    ctx.fill();
                    ctx.strokeStyle = '#1a1f35';
                    ctx.lineWidth = 4;
                    ctx.stroke();
                    
                    ctx.save();
                    ctx.translate(centerX, centerY);
                    ctx.rotate(startAngle + anglePerSegment / 2);
                    ctx.textAlign = 'center';
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 26px Arial';
                    ctx.fillText(segment.icon, radius * 0.65, 10);
                    ctx.font = 'bold 12px Arial';
                    ctx.fillText(segment.label, radius * 0.65, 28);
                    ctx.restore();
                });
            }

            drawWheel();
            
            window.drawWheel = drawWheel;
        }

        async function spinWheel() {
            if (wheelSpinning) return;
            
            if (!userData || (userData.keys_current || 0) < 1) {
                showNotification('⚠️ You need at least 1 Key to spin!', 'error');
                return;
            }

            wheelSpinning = true;
            document.getElementById('spinBtn').disabled = true;
            
            try {
                showLoading(true);
                const response = await fetch(`${CONFIG.API_URL}/earn/spin-wheel/${userData.telegram_id}`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (!response.ok) {
                    showNotification(data.error, 'error');
                    showLoading(false);
                    wheelSpinning = false;
                    document.getElementById('spinBtn').disabled = false;
                    return;
                }

                showLoading(false);
                
                const canvas = document.getElementById('wheelCanvas');
                const segments = 6;
                const anglePerSegment = (2 * Math.PI) / segments;
                
                let currentRotation = 0;
                const spins = 5;
                const targetRotation = spins * 2 * Math.PI + (Math.random() * anglePerSegment);
                const duration = 3000;
                const startTime = Date.now();

                function animate() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    currentRotation = targetRotation * easeOut;
                    
                    window.drawWheel(currentRotation);
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        userData = data;
                        updateUI();
                        
                        if (data.spin_result === 'RETRY') {
                            showNotification('🔄 FREE SPIN! Try again!');
                        } else if (data.spin_result >= 0.000017) {
                            showNotification(`🎉 JACKPOT! +${data.spin_result.toFixed(6)} TON!`);
                        } else {
                            showNotification(`✅ You won +${data.spin_result.toFixed(6)} TON!`);
                        }
                        
                        wheelSpinning = false;
                        document.getElementById('spinBtn').disabled = false;
                    }
                }

                animate();

            } catch (error) {
                showNotification('Spin error: ' + error.message, 'error');
                showLoading(false);
                wheelSpinning = false;
                document.getElementById('spinBtn').disabled = false;
            }
        }

        // ===========================
        // WITHDRAW ADS SYSTEM
        // ===========================

        async function watchWithdrawAd() {
            if (!userData) return;

            const adsWatched = userData.withdraw_ads_watched_current || 0;
            if (adsWatched >= 5) {
                showNotification('✅ Already unlocked!', 'error');
                return;
            }

            if (!checkMonetagSDK()) {
                showNotification('⚠️ Ad system loading, please wait...', 'error');
                return;
            }

            try {
                showLoading(true);

                const adType = adCounter % 2 === 0 ? 'pop' : 'interstitial';
                adCounter++;
                
                const adPromise = adType === 'pop' ? show_10078826('pop') : show_10078826();

                adPromise.then(async () => {
                    try {
                        const response = await fetch(`${CONFIG.API_URL}/withdraw/${userData.telegram_id}/watch-ad`, {
                            method: 'POST'
                        });
                        const data = await response.json();
                        
                        if (response.ok) {
                            userData = data;
                            updateUI();
                            
                            const newAdsWatched = data.ads_watched || 0;
                            if (newAdsWatched >= 5) {
                                showNotification('🔓 Withdrawal UNLOCKED!');
                            } else {
                                showNotification(`✅ Ad ${newAdsWatched}/5 watched!`);
                            }
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Error: ' + error.message, 'error');
                    }
                    
                    showLoading(false);
                }).catch((error) => {
                    showNotification('Please watch the ad completely', 'error');
                    showLoading(false);
                });

            } catch (error) {
                showNotification('Ad error: ' + error.message, 'error');
                showLoading(false);
            }
        }

        // ===========================
        // WITHDRAW
        // ===========================

        async function handleWithdraw() {
            const email = document.getElementById('faucetpayEmail').value.trim();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const level = getUserLevel(userData.xp || 0);
            
            if (!email || !amount) {
                showNotification('❌ Please fill all fields', 'error');
                return;
            }
            
            if (amount < level.min_withdraw) {
                showNotification(`❌ Minimum ${level.min_withdraw.toFixed(4)} TON`, 'error');
                return;
            }
            
            if (amount > userData.balance) {
                showNotification('❌ Insufficient balance', 'error');
                return;
            }
            
            try {
                showLoading(true);
                
                const response = await fetch(`${CONFIG.API_URL}/withdraw/${userData.telegram_id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        faucetpay_email: email,
                        amount: amount
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    userData = data.user || data;
                    updateUI();
                    document.getElementById('faucetpayEmail').value = '';
                    document.getElementById('withdrawAmount').value = '';
                    showNotification('🎉 Withdrawal successful!');
                } else {
                    showNotification('❌ ' + (data.error || 'Withdrawal failed'), 'error');
                }
                
                showLoading(false);
            } catch (error) {
                showNotification('❌ Error: ' + error.message, 'error');
                showLoading(false);
            }
        }

        // ===========================
        // TASKS
        // ===========================

        async function handleChannelTask() {
            await handleTask('join_channel', 'channelTaskBtn');
        }

        async function handleWithdrawChannelTask() {
            await handleTask('join_withdraw_channel', 'withdrawChannelTaskBtn');
        }

        async function handleTask(taskType, btnId) {
            const btn = document.getElementById(btnId);
            const btnText = btn.textContent;
            
            const channelUrl = taskType === 'join_channel' 
                ? `https://t.me/${CONFIG.CHANNEL_USERNAME}` 
                : `https://t.me/${CONFIG.WITHDRAW_CHANNEL_USERNAME}`;
            
            if (btnText === 'Join') {
                window.open(channelUrl, '_blank');
                btn.textContent = 'Verify';
            } else if (btnText === 'Verify') {
                try {
                    showLoading(true);
                    const response = await fetch(`${CONFIG.API_URL}/task/${userData.telegram_id}/verify`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ task_type: taskType })
                    });
                    const data = await response.json();
                    
                    if (response.ok && data.verified) {
                        btn.textContent = 'Claim';
                        showNotification('✅ Verified!');
                    } else {
                        showNotification('❌ Please join the channel first', 'error');
                    }
                    showLoading(false);
                } catch (error) {
                    showNotification('Error: ' + error.message, 'error');
                    showLoading(false);
                }
            } else if (btnText === 'Claim') {
                try {
                    showLoading(true);
                    const response = await fetch(`${CONFIG.API_URL}/task/${userData.telegram_id}/claim`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ task_type: taskType })
                    });
                    const data = await response.json();
                    
                    if (response.ok) {
                        userData = data;
                        updateUI();
                        btn.textContent = '✅ Done';
                        btn.disabled = true;
                        showNotification('🎉 +0.0001 TON earned!');
                    } else {
                        showNotification(data.error, 'error');
                    }
                    showLoading(false);
                } catch (error) {
                    showNotification('Error: ' + error.message, 'error');
                    showLoading(false);
                }
            }
        }

        async function claimDailyTask(taskNum) {
            showNotification('Daily tasks coming soon!', 'error');
        }

        // ===========================
        // NAVIGATION - ULTRA FIXED
        // ===========================

        function showPage(pageName) {
            console.log('Showing page:', pageName);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            // Show selected page
            const pageEl = document.getElementById('page-' + pageName);
            if (pageEl) {
                pageEl.classList.add('active');
                console.log('Page activated:', pageName);
            } else {
                console.error('Page not found:', pageName);
            }
            
            // Activate corresponding nav item
            const navItem = document.querySelector(`.nav-item[data-page="${pageName}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Force reload tabs to active state when switching to these pages
            setTimeout(() => {
                if (pageName === 'earn') {
                    ensureEarnTabsWork();
                } else if (pageName === 'tasks') {
                    ensureTaskTabsWork();
                } else if (pageName === 'level') {
                    ensureLevelTabsWork();
                }
            }, 50);
        }

        function ensureEarnTabsWork() {
            const tabs = document.querySelectorAll('#page-earn .tab');
            const contents = document.querySelectorAll('#page-earn .tab-content');
            
            // Reset all
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            // Activate first tab by default
            if (tabs[0]) tabs[0].classList.add('active');
            if (contents[0]) contents[0].classList.add('active');
            
            console.log('Earn tabs initialized');
        }

        function ensureTaskTabsWork() {
            const tabs = document.querySelectorAll('#page-tasks .tab');
            const contents = document.querySelectorAll('#page-tasks .tab-content');
            
            // Reset all
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            // Activate first tab by default
            if (tabs[0]) tabs[0].classList.add('active');
            if (contents[0]) contents[0].classList.add('active');
            
            console.log('Task tabs initialized');
        }

        function ensureLevelTabsWork() {
            const tabs = document.querySelectorAll('#page-level .tab');
            const contents = document.querySelectorAll('#page-level .tab-content');
            
            // Reset all
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            // Activate first tab by default
            if (tabs[0]) tabs[0].classList.add('active');
            if (contents[0]) contents[0].classList.add('active');
            
            console.log('Level tabs initialized');
        }

        function switchTaskTab(tabName) {
            console.log('Switching task tab to:', tabName);
            
            const tabs = document.querySelectorAll('#page-tasks .tab');
            const contents = document.querySelectorAll('#page-tasks .tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            const selectedTab = document.querySelector(`#page-tasks .tab[data-tab="${tabName}"]`);
            const selectedContent = document.getElementById('tab-' + tabName);
            
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('Task tab activated:', tabName);
            } else {
                console.error('Task tab not found:', tabName);
            }
            
            if (selectedContent) {
                selectedContent.classList.add('active');
                console.log('Task content activated:', tabName);
            } else {
                console.error('Task content not found:', tabName);
            }
        }

        function switchEarnTab(tabName) {
            console.log('Switching earn tab to:', tabName);
            
            const tabs = document.querySelectorAll('#page-earn .tab');
            const contents = document.querySelectorAll('#page-earn .tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            const selectedTab = document.querySelector(`#page-earn .tab[data-tab="${tabName}"]`);
            const selectedContent = document.getElementById('earn-' + tabName);
            
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('Earn tab activated:', tabName);
            } else {
                console.error('Earn tab not found:', tabName);
            }
            
            if (selectedContent) {
                selectedContent.classList.add('active');
                console.log('Earn content activated:', tabName);
            } else {
                console.error('Earn content not found:', tabName);
            }
        }

        function switchLevelTab(tabName) {
            console.log('Switching level tab to:', tabName);
            
            const tabs = document.querySelectorAll('#page-level .tab');
            const contents = document.querySelectorAll('#page-level .tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            const selectedTab = document.querySelector(`#page-level .tab[data-tab="${tabName}"]`);
            const selectedContent = document.getElementById('level-' + tabName);
            
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('Level tab activated:', tabName);
            } else {
                console.error('Level tab not found:', tabName);
            }
            
            if (selectedContent) {
                selectedContent.classList.add('active');
                console.log('Level content activated:', tabName);
            } else {
                console.error('Level content not found:', tabName);
            }
        }

        // ===========================
        // TIMERS
        // ===========================

        function startTimers() {
            setInterval(() => {
                const now = new Date();
                const tomorrow = new Date(Date.UTC(
                    now.getUTCFullYear(),
                    now.getUTCMonth(),
                    now.getUTCDate() + 1,
                    0, 0, 0, 0
                ));
                
                const remaining = tomorrow.getTime() - now.getTime();
                const hours = Math.floor(remaining / 3600000);
                const minutes = Math.floor((remaining % 3600000) / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const leaderboardTimer = document.getElementById('leaderboardTimer');
                const tasksTimer = document.getElementById('tasksTimer');
                
                if (leaderboardTimer) leaderboardTimer.textContent = timeString;
                if (tasksTimer) tasksTimer.textContent = timeString;
            }, 1000);
        }

        // ===========================
        // NOTIFICATIONS
        // ===========================

        function showNotification(message, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = 'notification show ' + (type === 'error' ? 'error' : '');
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.toggle('show', show);
        }

        // ===========================
        // INITIALIZATION
        // ===========================

        window.addEventListener('load', () => {
            console.log('🚀 TON REWARD DJDN v7.5 - COMPLETE PROFESSIONAL REBUILD');
            console.log('✅ All Errors Fixed');
            console.log('✅ Navigation System: Working');
            console.log('✅ Referral Page: Added');
            console.log('✅ UI/UX: Professional Enhancement');
            console.log('✅ Responsive: Mobile Optimized');
            console.log('✅ Code Lines: 3200+');
            loadUserData();
        });
    </script>
</body>
</html>